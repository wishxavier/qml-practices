# v3.0.0 - QML Singleton çµ±ä¸€ä»‹é¢ç‰ˆï¼ˆæ•…äº‹å››åˆ°ä¹ï¼šéŽç¨‹é‡é»žç´€éŒ„ï¼‰

## ðŸ› æ•…äº‹å››ï½žä¹ï¼šæ¯å€‹æ•…äº‹çš„éŽç¨‹é‡é»ž

---

### æ•…äº‹å››ï¼šçœ‹èµ·ä¾†éƒ½å°ï¼Œä½† ColorUtils is not defined çš„ç¥žç§˜æ¡ˆä¾‹

- **è¡Œå‹•**ï¼šåœ¨ color_utils.qml ä¸­åŠ ä¸Š `pragma Singleton`ï¼Œä¸¦æ–¼ Main.qml å˜—è©¦ `ColorUtils.randomColor()`ã€‚
- **å•é¡Œ**ï¼šåŸ·è¡Œæ™‚ QML å ±éŒ¯ `ColorUtils is not defined`ã€‚
- **åŽŸå› ç™¼ç¾**ï¼šæª¢æŸ¥ CMakeLists.txtï¼Œç™¼ç¾æ²’æœ‰ç‚º color_utils.qml è¨­å®š `QT_QML_SINGLETON_TYPE` å±¬æ€§ã€‚
- **ä¿®æ­£æ–¹æ¡ˆ**ï¼šåŠ å…¥ `set_source_files_properties(resources/qml_utils/color_utils.qml PROPERTIES QT_QML_SINGLETON_TYPE TRUE)`ã€‚
- **çµæžœ**ï¼šSingleton å¯è¢« QML ç³»çµ±è¾¨è­˜ï¼Œä½†ä»ç„¡æ³•æ­£å¸¸å‘¼å«æ–¹æ³•ï¼Œå‡ºç¾ undefined éŒ¯èª¤ã€‚

---

### æ•…äº‹äº”ï¼šAI å»ºè­°çš„æƒ¡å¤¢

- **è¡Œå‹•**ï¼šä¾æ“š AI å»ºè­°æ›´æ”¹ import åç¨±ï¼ˆå¦‚ `import qml_interaction 1.0 as Utils`ï¼‰ï¼Œä¸¦å˜—è©¦å¤šç¨®å‘½åæ–¹å¼ã€‚
- **å•é¡Œ**ï¼šQML å ±éŒ¯ `Type color_utils not declared as singleton in qmldir but using pragma Singleton [import]`ã€‚
- **åŽŸå› ç™¼ç¾**ï¼šAI å»ºè­°çš„æ¨¡çµ„åç¨±èˆ‡ CMake è¨»å†Šä¸ç¬¦ï¼ŒSingleton åž‹åˆ¥æœªæ­£ç¢ºå®£å‘Šæ–¼ qmldirã€‚
- **ä¿®æ­£æ–¹æ¡ˆ**ï¼šçž­è§£è‡ªå‹• qmldir ç”Ÿæˆæ©Ÿåˆ¶ï¼Œæ„è­˜åˆ°å¿…é ˆè®“ CMake è¨­å®šèˆ‡åž‹åˆ¥å‘½åä¸€è‡´ã€‚
- **çµæžœ**ï¼šå•é¡Œæœªè§£æ±ºï¼ŒAI é€²ä¸€æ­¥å»ºè­°æ‰‹å‹•å»ºç«‹ qmldirï¼Œå°Žè‡´æµç¨‹è®Šå¾—æ··äº‚ã€‚

---

### æ•…äº‹å…­ï¼šæ‰‹å‹•æŽ¥ç®¡ qmldir æŽ§åˆ¶æ¬Š

- **è¡Œå‹•**ï¼šåœ¨ CMakeLists.txt åŠ ä¸Š `NO_GENERATE_QMLDIR`ï¼Œæ‰‹å‹•æ’°å¯« qmldir æª”æ¡ˆï¼Œæ˜Žç¢ºæŒ‡å®š singleton åž‹åˆ¥ã€‚
- **å•é¡Œ**ï¼šæ‰‹å‹•ç®¡ç†é›–å¯è¡Œï¼Œä½†å¢žåŠ ç¶­è­·æˆæœ¬ä¸”æ˜“å‡ºéŒ¯ï¼›é©—è­‰éŽç¨‹ä¸­å¯æ­£ç¢ºè¼‰å…¥ Singletonï¼Œä½†æ¯æ¬¡æ”¹å‹•éƒ½éœ€æ‰‹å‹•åŒæ­¥ qmldirã€‚
- **åŽŸå› ç™¼ç¾**ï¼šQt6 åŽŸæœ¬è¨­è¨ˆè‡ªå‹•åŒ–ç®¡ç†ï¼Œæ‰‹å‹•æ¨¡å¼é›–å¯è§£ï¼Œä½†éžé•·é ä¹‹è¨ˆã€‚
- **ä¿®æ­£æ–¹æ¡ˆ**ï¼šæ±ºå®šå›žæ­¸è‡ªå‹•æ¨¡å¼ï¼Œå°‹æ‰¾æ­£ç¢ºè‡ªå‹•åŒ–è¨»å†Šæ–¹å¼ã€‚
- **çµæžœ**ï¼šçž­è§£ QML æ¨¡çµ„è¨»å†Šåº•å±¤é‚è¼¯ï¼Œå»ºç«‹æ­£ç¢ºçŸ¥è­˜åŸºç¤Žã€‚

---

### æ•…äº‹ä¸ƒï¼šå›žæ­¸è‡ªå‹•æ¨¡å¼çš„æ–°å´©æ½°

- **è¡Œå‹•**ï¼šç§»é™¤æ‰‹å‹• qmldirï¼Œæ¢å¾©è‡ªå‹•ç”Ÿæˆï¼Œä¿æŒ CMakeLists.txt çš„æ¨™æº–è¨­å®šï¼Œä½¿ç”¨ç¤¾ç¾¤å»ºè­°çš„å‘½åæ–¹å¼ã€‚
- **å•é¡Œ**ï¼šåŸ·è¡Œæ™‚ QML å ±éŒ¯ `TypeError: Cannot call method 'randomColor' of undefined`ï¼ŒSingleton åž‹åˆ¥ä»æœªè¢«æ­£ç¢ºè¨»å†Šã€‚
- **åŽŸå› ç™¼ç¾**ï¼šç™¼ç¾ CMake è¨­å®šä¸­åž‹åˆ¥åç¨± (`QT_QML_SOURCE_TYPENAME`) èˆ‡ QML ä½¿ç”¨åç¨±ä¸ä¸€è‡´ï¼Œå°Žè‡´ QML æ‰¾ä¸åˆ° Singletonã€‚
- **ä¿®æ­£æ–¹æ¡ˆ**ï¼šçµ±ä¸€å‘½åè¦å‰‡ï¼Œç¢ºä¿ CMake è¨»å†Šåž‹åˆ¥åç¨±èˆ‡ QML ä½¿ç”¨åç¨±ä¸€è‡´ã€‚
- **çµæžœ**ï¼šSingleton åž‹åˆ¥é–‹å§‹å¯è¢« QML è¾¨è­˜ï¼Œä½†ä»æœ‰ç´°ç¯€éœ€èª¿æ•´ã€‚

---

### æ•…äº‹å…«ï¼šAI æŠ•é™ä½†å·¥ç¨‹å¸«ä¸æ”¾æ£„

- **è¡Œå‹•**ï¼šAI å»ºè­°å†æ¬¡æ‰‹å‹• qmldirï¼Œé–‹ç™¼è€…æ‹’çµ•ä¸¦å …æŒè‡ªå‹•åŒ–è§£æ³•ï¼ŒæŒçºŒæª¢æŸ¥ CMake èˆ‡ QML è¨»å†Šç´°ç¯€ã€‚
- **å•é¡Œ**ï¼šqmldir ä»æœªè‡ªå‹•å‡ºç¾ singleton å®£å‘Šï¼ŒSingleton åž‹åˆ¥å¶çˆ¾æœªæ­£ç¢ºè¢« QML è¾¨è­˜ã€‚
- **åŽŸå› ç™¼ç¾**ï¼šæ·±å…¥ç ”ç©¶ CMake å±¬æ€§è¨­å®šï¼Œç™¼ç¾éœ€åŒæ™‚è¨­ç½® `QT_QML_SINGLETON_TYPE` èˆ‡ `QT_QML_SOURCE_TYPENAME`ã€‚
- **ä¿®æ­£æ–¹æ¡ˆ**ï¼šåœ¨ CMakeLists.txt ä¸­è£œä¸Šå…©å€‹å±¬æ€§ï¼Œä¸¦çµ±ä¸€å‘½åç‚º ColorUtilsã€‚
- **çµæžœ**ï¼šSingleton åž‹åˆ¥è‡ªå‹•è¨»å†ŠæˆåŠŸï¼ŒQML å¯æ­£ç¢ºå‘¼å«æ‰€æœ‰æ–¹æ³•ã€‚

---

### æ•…äº‹ä¹ï¼šæ•‘ä¸–ä¸»é™è‡¨ï¼Œæœ€çµ‚å‹åˆ©

- **è¡Œå‹•**ï¼šå°‡ CMake å±¬æ€§è¨­ç½®å®Œå–„ã€å‘½åå…¨éƒ¨éµå¾ªç¤¾ç¾¤æ¨™æº–ï¼Œæ¸¬è©¦å¤šç¨® QML import å¯«æ³•ã€‚
- **å•é¡Œ**ï¼šæœ€å¾Œé©—è­‰æ‰€æœ‰å‘¼å«æ–¹å¼çš†å¯é‹ä½œï¼ŒSingleton è‡ªå‹•è¨»å†Šç„¡èª¤ã€‚
- **åŽŸå› ç™¼ç¾**ï¼šæ­£ç¢ºçš„ CMake è¨­å®šç‚º Singleton åž‹åˆ¥è‡ªå‹•è¨»å†Šé—œéµï¼Œå‘½åä¸€è‡´æ€§æ˜¯æˆåŠŸè¦ç´ ã€‚
- **ä¿®æ­£æ–¹æ¡ˆ**ï¼šæœ€çµ‚ CMake è¨­å®šå¦‚ä¸‹ï¼š
  ```cmake
  set_source_files_properties(resources/qml_utils/color_utils.qml
      PROPERTIES
          QT_QML_SINGLETON_TYPE TRUE
          QT_QML_SOURCE_TYPENAME "ColorUtils"
  )
  ```
- **çµæžœ**ï¼šQML å¯ç›´æŽ¥ç”¨ `ColorUtils.randomColor()`ï¼Œç³»çµ±ç©©å®šã€å¯ç¶­è­·ã€ç¬¦åˆæœ€ä½³å¯¦å‹™ï¼Œçµ‚æ–¼å¤§åŠŸå‘Šæˆï¼

---

## ðŸŽ¯ å·¥ç¨‹å¸«æ€è€ƒè„ˆçµ¡ç¸½çµ

- è¡Œå‹• â†’ å•é¡Œ â†’ åŽŸå› åˆ†æž â†’ ä¿®æ­£ â†’ çµæžœ
- æ¯æ¬¡ä¿®æ­£éƒ½å»ºç«‹åœ¨ä¸Šä¸€æ¬¡å¤±æ•—çš„æ·±åº¦ç†è§£ä¹‹ä¸Š
- æœ€çµ‚ç²å¾—å®Œæ•´ Singleton æŠ€è¡“èˆ‡è‡ªå‹•åŒ–å·¥å…·éˆçš„ä¿¡å¿ƒï¼

---

> é€™ä»½ç´€éŒ„ä¸åªæ˜¯æŠ€è¡“æ–‡ä»¶ï¼Œæ›´æ˜¯å·¥ç¨‹å¸«ç²¾ç¥žçš„è¦‹è­‰ï¼  
> â€”â€” wishxavier, 2025-07-18
